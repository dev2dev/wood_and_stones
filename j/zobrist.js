// (c) 2010 Reg Braithwaite. All rights to the entirety of the program and its parts are reserved with 
// the exception of specific files otherwise licensed. Other licenses apply only to the files where
// they appear.

;(function ($, F, undefined) {
	
	var hashes = {
		black: {
			aa:192863371,
			ab:174368266,
			ac:947469291,
			ad:837180591,
			ae:992529583,
			af:437598347,
			ag:170448254,
			ah:563857448,
			ai:99960002,
			aj:959935106,
			ak:342288268,
			al:832916996,
			am:752103185,
			an:524072302,
			ao:816336706,
			ap:767453080,
			aq:45785042,
			ar:887441319,
			as:510884044,
			ba:1070070658,
			bb:968833400,
			bc:966459607,
			bd:658542902,
			be:759154479,
			bf:684345806,
			bg:162883224,
			bh:508071567,
			bi:1018277494,
			bj:982840516,
			bk:569596669,
			bl:486820822,
			bm:832462850,
			bn:740286361,
			bo:1041353154,
			bp:16103498,
			bq:753000560,
			br:524634460,
			bs:206272353,
			ca:864814916,
			cb:821214265,
			cc:270989558,
			cd:1003089921,
			ce:654486362,
			cf:702214770,
			cg:303606656,
			ch:484159583,
			ci:731055675,
			cj:959509050,
			ck:835112742,
			cl:1039005013,
			cm:705705938,
			cn:1009504058,
			co:962522286,
			cp:699776779,
			cq:906564114,
			cr:907354466,
			cs:183204947,
			da:256922741,
			db:475686381,
			dc:584749549,
			dd:1062358067,
			de:960931627,
			df:1002398147,
			dg:820721246,
			dh:846652621,
			di:355056583,
			dj:570547441,
			dk:817170772,
			dl:315841257,
			dm:449382191,
			dn:477139587,
			'do':337714735,
			dp:731451646,
			dq:284103599,
			dr:476131832,
			ds:639219426,
			ea:204771671,
			eb:888017990,
			ec:535913125,
			ed:326017050,
			ee:91425384,
			ef:657548552,
			eg:208697607,
			eh:788769920,
			ei:300994117,
			ej:630769508,
			ek:529300401,
			el:950412761,
			em:154888327,
			en:1025060270,
			eo:1012048320,
			ep:610994125,
			eq:193035211,
			er:13146760,
			es:757475153,
			fa:567032493,
			fb:904294838,
			fc:570433751,
			fd:1024389149,
			fe:109644816,
			ff:1029783105,
			fg:591145169,
			fh:393713413,
			fi:12309070,
			fj:122974589,
			fk:978287912,
			fl:838317256,
			fm:383286821,
			fn:1044078458,
			fo:997320492,
			fp:250989999,
			fq:694266327,
			fr:635695451,
			fs:226053063,
			ga:481015897,
			gb:34678844,
			gc:184191345,
			gd:1030192830,
			ge:589180485,
			gf:390281416,
			gg:431928123,
			gh:475934231,
			gi:36850392,
			gj:917653256,
			gk:942160611,
			gl:368448118,
			gm:145246221,
			gn:323706882,
			go:431284581,
			gp:1049596440,
			gq:992864170,
			gr:836634349,
			gs:331581215,
			ha:71601186,
			hb:931171684,
			hc:349473736,
			hd:881523503,
			he:880295770,
			hf:254016524,
			hg:530875478,
			hh:738198610,
			hi:371426466,
			hj:1045366072,
			hk:41116310,
			hl:429538357,
			hm:496285621,
			hn:463136648,
			ho:642087863,
			hp:956248856,
			hq:1066833980,
			hr:914316585,
			hs:273673911,
			ia:401989093,
			ib:270557150,
			ic:880953676,
			id:845946754,
			ie:542975219,
			'if':786963055,
			ig:48098114,
			ih:1002179531,
			ii:149352042,
			ij:349286813,
			ik:975988347,
			il:1061567702,
			im:483019950,
			'in':924193027,
			io:539839649,
			ip:713479223,
			iq:51249961,
			ir:523026336,
			is:751226239,
			ja:543682930,
			jb:520753863,
			jc:291600154,
			jd:391407628,
			je:219026511,
			jf:622480484,
			jg:995347951,
			jh:553581102,
			ji:757918507,
			jj:640210408,
			jk:61215083,
			jl:843706505,
			jm:334079542,
			jn:583949381,
			jo:735583523,
			jp:135550858,
			jq:874395261,
			jr:542448219,
			js:786256535,
			ka:944545938,
			kb:383282915,
			kc:751506018,
			kd:316368711,
			ke:899808448,
			kf:506875253,
			kg:24559058,
			kh:525285662,
			ki:1031494835,
			kj:1010777400,
			kk:151086166,
			kl:23898178,
			km:359156893,
			kn:53039417,
			ko:115608700,
			kp:730723762,
			kq:121202122,
			kr:677447904,
			ks:120618448,
			la:339198693,
			lb:886848360,
			lc:237450139,
			ld:653582840,
			le:765816056,
			lf:120158340,
			lg:896356639,
			lh:318082940,
			li:811331714,
			lj:372819451,
			lk:980313648,
			ll:116406906,
			lm:742217485,
			ln:917856601,
			lo:1012592965,
			lp:265874438,
			lq:623841774,
			lr:512990855,
			ls:827374584,
			ma:569035299,
			mb:98768996,
			mc:811243803,
			md:278869706,
			me:528864637,
			mf:628682380,
			mg:192982757,
			mh:574671631,
			mi:926085278,
			mj:790682268,
			mk:88232658,
			ml:916794851,
			mm:710398043,
			mn:127117839,
			mo:338760916,
			mp:11624262,
			mq:629906947,
			mr:916234726,
			ms:255778401,
			na:41917394,
			nb:719251716,
			nc:917810314,
			nd:126279633,
			ne:155542717,
			nf:149707989,
			ng:667483847,
			nh:185824169,
			ni:195105540,
			nj:307292613,
			nk:540156691,
			nl:202625687,
			nm:133185389,
			nn:1007307843,
			no:76900194,
			np:483226545,
			nq:782963985,
			nr:734196733,
			ns:854165490,
			oa:978507809,
			ob:1051898861,
			oc:873655650,
			od:188671101,
			oe:11511486,
			of:623686574,
			og:829876734,
			oh:273489937,
			oi:706193849,
			oj:740360414,
			ok:1013658756,
			ol:809048587,
			om:465143436,
			on:373310510,
			oo:482637092,
			op:325220190,
			oq:800043452,
			or:896175073,
			os:378798242,
			pa:633406778,
			pb:1024463844,
			pc:451035402,
			pd:298885548,
			pe:1026053211,
			pf:811009697,
			pg:987574653,
			ph:832631731,
			pi:438320953,
			pj:847892991,
			pk:902306104,
			pl:658529693,
			pm:44134303,
			pn:700464735,
			po:596780846,
			pp:1022065603,
			pq:481928629,
			pr:191586557,
			ps:613977146,
			qa:155211234,
			qb:222488420,
			qc:364726937,
			qd:417295267,
			qe:66737014,
			qf:913657952,
			qg:109837195,
			qh:388898003,
			qi:168627968,
			qj:997010939,
			qk:452139411,
			ql:812986269,
			qm:197510662,
			qn:58355943,
			qo:206211066,
			qp:543640823,
			qq:982351934,
			qr:39870529,
			qs:10714915,
			ra:265845125,
			rb:770015812,
			rc:74651919,
			rd:506657698,
			re:310240832,
			rf:989172452,
			rg:996253410,
			rh:1028379396,
			ri:322888349,
			rj:208030949,
			rk:794402928,
			rl:259760888,
			rm:969240339,
			rn:857041528,
			ro:624940497,
			rp:301352578,
			rq:466773390,
			rr:165771946,
			rs:91951337,
			sa:518965621,
			sb:224612551,
			sc:1070667357,
			sd:1061619261,
			se:290775978,
			sf:1014763448,
			sg:230964312,
			sh:221757215,
			si:663744438,
			sj:481164793,
			sk:205209719,
			sl:568224464,
			sm:582615625,
			sn:1034202169,
			so:883213482,
			sp:1066805307,
			sq:153944356,
			sr:524937594,
			ss:852329624
		},
		white: {
			aa:765313858,
			ab:574582708,
			ac:182477534,
			ad:494825773,
			ae:904428411,
			af:165126941,
			ag:533892031,
			ah:263955442,
			ai:281700177,
			aj:172407674,
			ak:827991196,
			al:940364031,
			am:491085418,
			an:569868356,
			ao:806312601,
			ap:206159210,
			aq:730398118,
			ar:153105360,
			as:293372592,
			ba:327489339,
			bb:1013823439,
			bc:1023478140,
			bd:175627609,
			be:276815631,
			bf:856785354,
			bg:990148095,
			bh:563316278,
			bi:804157592,
			bj:928609607,
			bk:263322071,
			bl:917282160,
			bm:153516226,
			bn:1072543713,
			bo:731385893,
			bp:598877878,
			bq:515683970,
			br:1039982872,
			bs:324869498,
			ca:411671173,
			cb:1003267119,
			cc:928733014,
			cd:518679184,
			ce:906365862,
			cf:870061172,
			cg:1048597104,
			ch:141417638,
			ci:452870558,
			cj:541665937,
			ck:714386623,
			cl:475289188,
			cm:1040878093,
			cn:916603396,
			co:1031798696,
			cp:906814005,
			cq:338802418,
			cr:851213999,
			cs:122139541,
			da:681871609,
			db:934372318,
			dc:777810761,
			dd:950905264,
			de:353358747,
			df:711039997,
			dg:555938185,
			dh:597226160,
			di:189305086,
			dj:733031363,
			dk:753078072,
			dl:575617959,
			dm:740549927,
			dn:71323117,
			'do':273484133,
			dp:588378461,
			dq:294255137,
			dr:810490292,
			ds:328664309,
			ea:736643606,
			eb:831163792,
			ec:966367578,
			ed:120979045,
			ee:320452783,
			ef:684462886,
			eg:971592698,
			eh:876463547,
			ei:647202485,
			ej:409326200,
			ek:147588735,
			el:162294441,
			em:386698994,
			en:1024756698,
			eo:341871525,
			ep:756341889,
			eq:559683183,
			er:759686638,
			es:684975722,
			fa:584871742,
			fb:48643169,
			fc:987281954,
			fd:87444525,
			fe:850828222,
			ff:759746652,
			fg:1020116241,
			fh:855679495,
			fi:346528047,
			fj:350571622,
			fk:969783149,
			fl:214695600,
			fm:561728925,
			fn:342893878,
			fo:657354184,
			fp:95756698,
			fq:397524086,
			fr:972899348,
			fs:1029668239,
			ga:343504152,
			gb:88886190,
			gc:270311997,
			gd:331942856,
			ge:391677775,
			gf:281148122,
			gg:750473329,
			gh:230341295,
			gi:493253082,
			gj:428850850,
			gk:222564064,
			gl:324698869,
			gm:706851384,
			gn:596915254,
			go:121487747,
			gp:883899249,
			gq:417376197,
			gr:21270996,
			gs:563681845,
			ha:785794072,
			hb:619089385,
			hc:427969165,
			hd:978481283,
			he:378100302,
			hf:199483887,
			hg:944129447,
			hh:339519586,
			hi:938149483,
			hj:461261238,
			hk:184113035,
			hl:691263067,
			hm:791352186,
			hn:650300058,
			ho:837400027,
			hp:259988002,
			hq:517131945,
			hr:818215359,
			hs:745947990,
			ia:404083779,
			ib:215085831,
			ic:534734261,
			id:305908650,
			ie:951964832,
			'if':784976912,
			ig:638573585,
			ih:191319601,
			ii:1013331593,
			ij:982358308,
			ik:82805861,
			il:191762646,
			im:900848981,
			'in':305811770,
			io:889071157,
			ip:347647131,
			iq:472289365,
			ir:653174598,
			is:503189615,
			ja:1022227358,
			jb:423088058,
			jc:92616686,
			jd:812490597,
			je:378333329,
			jf:774943737,
			jg:726496132,
			jh:760972520,
			ji:843672744,
			jj:484204314,
			jk:989684850,
			jl:803046823,
			jm:372850492,
			jn:76014146,
			jo:779414368,
			jp:855352137,
			jq:625483886,
			jr:818827880,
			js:730231811,
			ka:399888880,
			kb:686916901,
			kc:90962301,
			kd:225188980,
			ke:581637101,
			kf:825217269,
			kg:481225167,
			kh:731412029,
			ki:96888966,
			kj:56353366,
			kk:481826108,
			kl:905248015,
			km:732135443,
			kn:570699119,
			ko:1572969,
			kp:531510240,
			kq:89004938,
			kr:521485215,
			ks:913467831,
			la:108890206,
			lb:292422126,
			lc:74846352,
			ld:183386534,
			le:948788124,
			lf:532898736,
			lg:36721436,
			lh:607708738,
			li:883264258,
			lj:644798105,
			lk:558603885,
			ll:842916199,
			lm:672229712,
			ln:81267997,
			lo:206854861,
			lp:222064247,
			lq:831026333,
			lr:143545219,
			ls:621748704,
			ma:745806484,
			mb:670896634,
			mc:527730926,
			md:319293492,
			me:446337891,
			mf:683641686,
			mg:70327987,
			mh:745543998,
			mi:206799146,
			mj:1000120990,
			mk:182666247,
			ml:504815,
			mm:416502265,
			mn:771164841,
			mo:848980650,
			mp:378296337,
			mq:279970609,
			mr:135890792,
			ms:288165938,
			na:648719960,
			nb:930269623,
			nc:738943794,
			nd:996888549,
			ne:705283157,
			nf:544612624,
			ng:820966066,
			nh:477094259,
			ni:328845300,
			nj:549571608,
			nk:929175516,
			nl:771356823,
			nm:1064561542,
			nn:1071351786,
			no:686516500,
			np:364699240,
			nq:789929570,
			nr:433798440,
			ns:362775595,
			oa:786826334,
			ob:629473327,
			oc:728546370,
			od:322632526,
			oe:432282788,
			of:964637025,
			og:593250089,
			oh:649204658,
			oi:834001077,
			oj:1040894088,
			ok:521676547,
			ol:851279826,
			om:198161064,
			on:250980044,
			oo:413868596,
			op:775837320,
			oq:925455560,
			or:1052496827,
			os:583537368,
			pa:755721737,
			pb:26485829,
			pc:894047731,
			pd:1048774143,
			pe:1029509663,
			pf:541754531,
			pg:826708558,
			ph:522341158,
			pi:603784866,
			pj:683547817,
			pk:759098072,
			pl:649190193,
			pm:839579099,
			pn:752654407,
			po:267941022,
			pp:247157943,
			pq:1049588550,
			pr:650428247,
			ps:156936451,
			qa:558371108,
			qb:684711949,
			qc:902117779,
			qd:650905134,
			qe:427129262,
			qf:10079060,
			qg:758374291,
			qh:1058423875,
			qi:817188398,
			qj:644205005,
			qk:385932663,
			ql:213320495,
			qm:925268638,
			qn:93773090,
			qo:416501444,
			qp:106664311,
			qq:738792777,
			qr:970407695,
			qs:454804533,
			ra:95096207,
			rb:168539593,
			rc:180935648,
			rd:54259701,
			re:591458449,
			rf:729191374,
			rg:903448580,
			rh:736033238,
			ri:674458516,
			rj:103242449,
			rk:662708273,
			rl:707136271,
			rm:934998798,
			rn:187624888,
			ro:688746831,
			rp:365945156,
			rq:243975550,
			rr:1000579804,
			rs:182058457,
			sa:477273467,
			sb:614928497,
			sc:19459060,
			sd:175717287,
			se:75516895,
			sf:529722995,
			sg:11894284,
			sh:965419289,
			si:691520225,
			sj:946294677,
			sk:1014705694,
			sl:838014567,
			sm:438230529,
			sn:898652604,
			so:958781270,
			sp:679198476,
			sq:139234353,
			sr:499530953,
			ss:825867397
		}
	};

	var zobrist = function (optional_selection) {
		optional_selection = optional_selection ? optional_selection : $('.play .board .intersection');
		return F.reduce(function (outerhashval, colour) {
			return F.reduce(function (innerhashval, id) {
				return hashes[colour][id] ^ innerhashval;
			}, outerhashval, F.map('.idxc', selection.filter('.'+colour)))
		}, 0, ['black', 'white']);
	};
	
	$(function () {
		go.zobrist = zobrist;
	});
	
})(jQuery, Functional);