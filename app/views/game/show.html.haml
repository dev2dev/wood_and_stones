-# game/show.html.haml
-#
-# This version asynchronously requests moves from the server after rendering the latest move.
-# 
-# begin hideaous workaround for JQTouch and HAML: It seems that <div style='current' id='foo'> is treated differently than
-# <div id=';foo' style='current>, and HAML generates one form when you write .current{ :id=>'foo } and the other when you
-# write %div{ :style=>'current', :id=>'foo' }
-last = @game.actions.last
-user_to_play = @game.user_to_play
:javascript
  var enable_empty_places = function (div_num) {
    $('#m' + div_num + ' .board .empty').bind('click.place_stone',
      function (data) {
        var position = this.getAttribute('id');
        $.ajax({
          url: '#{move_url(:game_id=>@game.id, :position=>'zzzzz')}'.replace('zzzzz', position),
          type: 'POST',
          success: function (data) {
            disable_empty_places(div_num );
            GO.message('success', 'success placing a stone at ' + position);
          },
          error: function (data) {
            GO.message('error', 'unable to place a stone at ' + position + ' because: ' + data.responseText);
          },
        });
      }
    ).css({
      'cursor': 'pointer'
    });
  };
  var disable_empty_places = function(div_num) {
    $('#m' + div_num + ' .board .empty').unbind('click.place_stone',
      function (data) {
        var position = this.getAttribute('id');
        $.ajax({
          url: '#{move_url(:game_id=>@game.id, :position=>'zzzzz')}'.replace('zzzzz', position),
          type: 'POST',
          success: function (data) {
            GO.message('success', 'success placing a stone at ' + position);
          },
          error: function (data) {
            GO.message('error', 'unable to place a stone at ' + position + ' because: ' + data.responseText);
          },
        });
      }
    ).css({
      'cursor': 'default'
    });
  };
-last_div_num = last.nil? ? 0 : last.cardinality
-if user_to_play && user_to_play == self.current_user
  :javascript
    $(document).ready( function () {  
      enable_empty_places(#{last_div_num});
    });
-else
  :javascript
    $(document).ready( function () {  
      disable_empty_places(#{last_div_num});
    });
-if last.nil?
  .current#m0
    .toolbar 
      %h1 Beginning
      %a.back{:href=>"#"} Back
    .board
      = render :partial => "board/board", :locals => { :board => @game.initial_board }
-else
  #m0
    .toolbar 
      %h1 Beginning
      %a.back{:href=>"#"} Back
    .board
      = render :partial => "board/board", :locals => { :board => @game.initial_board }
    %ul.individual
      %li
        %a.slideleft{:href=>'#m1'}
          Next
          %small 1
  -@game.actions[0..-2].each do |action|
    %div{:id=>"m#{action.cardinality}"}
      .toolbar 
        %h1 Move #{action.cardinality}
        %a.back{:href=>"#"} Back
      .board
        = render :partial => "board/board", :locals => { :board => action.after }
      %ul.individual
        %li
          %a.slideright{:href=>"#m#{action.cardinality - 1}"}
            Prev
            %small
              = action.cardinality - 1
        %li
          %a.slideleft{:href=>"#m#{action.cardinality + 1}"}
            Next
            %small
              = action.cardinality + 1
  .current{:id=>"m#{last.cardinality}"}
    .toolbar 
      %h1 Move #{last.cardinality}
      %a.back{:href=>"#"} Back
    .board
      = render :partial => "board/board", :locals => { :board => last.after }
    %ul.individual
      %li
        %a.slideright{:href=>"#m#{last.cardinality - 1}"}
          Prev
          %small
            = last.cardinality - 1
#settings
  -# list all game settings